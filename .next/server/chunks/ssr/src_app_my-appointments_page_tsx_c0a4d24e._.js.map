{"version":3,"sources":["../../../../src/app/my-appointments/page.tsx","../../../../node_modules/date-fns/isAfter.js","../../../../node_modules/date-fns/addMilliseconds.js","../../../../node_modules/date-fns/addHours.js","../../../../node_modules/date-fns/subHours.js","../../../../src/lib/calendar.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { format, isAfter, subHours } from \"date-fns\";\nimport { generateICS } from \"@/lib/calendar\";\n\nexport default function MyAppointments() {\n    const [appointments, setAppointments] = useState<any[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [message, setMessage] = useState(\"\");\n\n    useEffect(() => {\n        fetchAppointments();\n    }, []);\n\n    async function fetchAppointments() {\n        try {\n            const res = await fetch(\"/api/appointments\");\n            if (res.ok) {\n                const data = await res.json();\n                setAppointments(data.appointments);\n            }\n        } catch (err) {\n            console.error(\"Error fetching appointments:\", err);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    async function handleCancel(id: string, dateTime: string) {\n        const bookingDate = new Date(dateTime);\n        const now = new Date();\n\n        // Logic: 24h before cancellation\n        if (!isAfter(bookingDate, subHours(now, -24))) {\n            alert(\"Часовете могат да бъдат отменяни най-малко 24 часа предварително.\");\n            return;\n        }\n\n        if (!confirm(\"Сигурни ли сте, че искате да отмените този час?\")) return;\n\n        try {\n            const res = await fetch(`/api/appointments?id=${id}`, {\n                method: \"PATCH\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ status: \"CANCELLED\" }),\n            });\n\n            if (res.ok) {\n                setMessage(\"Часът бе отменен успешно.\");\n                fetchAppointments();\n            } else {\n                const data = await res.json();\n                setMessage(data.error || \"Отмяната не бе успешна.\");\n            }\n        } catch (err) {\n            setMessage(\"Възникна грешка.\");\n        }\n    }\n\n    async function handleDownload(appt: any) {\n        const ics = generateICS({\n            id: appt.id,\n            dateTime: new Date(appt.dateTime),\n            duration: appt.duration,\n            summary: \"Педиатричен преглед: Д-р Злати\",\n            description: `Сесия: ${appt.notes || \"Клинична консултация\"}`\n        });\n\n        const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });\n        const url = window.URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.setAttribute('download', 'appointment.ics');\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    }\n\n    if (loading) return <div className=\"container\" style={{ padding: '4rem 0', textAlign: 'center' }}>Зареждане...</div>;\n\n    return (\n        <div className=\"container\" style={{ padding: '4rem 0' }}>\n            <h1 style={{ color: \"var(--primary-teal)\", textAlign: \"center\", marginBottom: '2rem' }}>Моите часове</h1>\n\n            {message && <div style={{ padding: '1rem', background: '#e0f7fa', color: '#006064', borderRadius: '4px', textAlign: 'center', marginBottom: '2rem' }}>{message}</div>}\n\n            <div style={{ background: 'white', padding: '2rem', borderRadius: '8px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }}>\n                {appointments.length === 0 ? (\n                    <p style={{ textAlign: 'center' }}>Нямате предстоящи часове.</p>\n                ) : (\n                    <div style={{ display: 'grid', gap: '1rem' }}>\n                        {appointments.map((appt) => (\n                            <div key={appt.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid #eee', paddingBottom: '1rem' }}>\n                                <div>\n                                    <div style={{ fontWeight: 'bold' }}>{format(new Date(appt.dateTime), \"PPPP\")}</div>\n                                    <div style={{ color: '#666' }}>{format(new Date(appt.dateTime), \"p\")} - {appt.status === 'CANCELLED' ? 'ОТМЕНЕН' : 'ПОТВЪРДЕН'}</div>\n                                </div>\n                                {appt.status !== 'CANCELLED' && (\n                                    <div style={{ display: 'flex', gap: '0.5rem' }}>\n                                        <button\n                                            onClick={() => handleDownload(appt)}\n                                            style={{ background: '#f4f9fa', color: 'var(--primary-teal)', border: '1px solid var(--primary-teal)', padding: '0.5rem 1rem', borderRadius: '4px', cursor: 'pointer', fontSize: '0.85rem', fontWeight: '800' }}\n                                        >\n                                            КАЛЕНДАР\n                                        </button>\n                                        <button\n                                            onClick={() => handleCancel(appt.id, appt.dateTime)}\n                                            style={{ background: '#fff5f5', color: '#c53030', border: '1px solid #feb2b2', padding: '0.5rem 1rem', borderRadius: '4px', cursor: 'pointer', fontSize: '0.85rem', fontWeight: '800' }}\n                                        >\n                                            ОТМЕНИ\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","import { toDate } from \"./toDate.js\";\n\n/**\n * @name isAfter\n * @category Common Helpers\n * @summary Is the first date after the second one?\n *\n * @description\n * Is the first date after the second one?\n *\n * @param date - The date that should be after the other one to return true\n * @param dateToCompare - The date to compare with\n *\n * @returns The first date is after the second date\n *\n * @example\n * // Is 10 July 1989 after 11 February 1987?\n * const result = isAfter(new Date(1989, 6, 10), new Date(1987, 1, 11))\n * //=> true\n */\nexport function isAfter(date, dateToCompare) {\n  return +toDate(date) > +toDate(dateToCompare);\n}\n\n// Fallback for modularized imports:\nexport default isAfter;\n","import { constructFrom } from \"./constructFrom.js\";\nimport { toDate } from \"./toDate.js\";\n\n/**\n * The {@link addMilliseconds} function options.\n */\n\n/**\n * @name addMilliseconds\n * @category Millisecond Helpers\n * @summary Add the specified number of milliseconds to the given date.\n *\n * @description\n * Add the specified number of milliseconds to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of milliseconds to be added.\n * @param options - The options object\n *\n * @returns The new date with the milliseconds added\n *\n * @example\n * // Add 750 milliseconds to 10 July 2014 12:45:30.000:\n * const result = addMilliseconds(new Date(2014, 6, 10, 12, 45, 30, 0), 750)\n * //=> Thu Jul 10 2014 12:45:30.750\n */\nexport function addMilliseconds(date, amount, options) {\n  return constructFrom(options?.in || date, +toDate(date) + amount);\n}\n\n// Fallback for modularized imports:\nexport default addMilliseconds;\n","import { addMilliseconds } from \"./addMilliseconds.js\";\nimport { millisecondsInHour } from \"./constants.js\";\n\n/**\n * The {@link addHours} function options.\n */\n\n/**\n * @name addHours\n * @category Hour Helpers\n * @summary Add the specified number of hours to the given date.\n *\n * @description\n * Add the specified number of hours to the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of hours to be added\n * @param options - An object with options\n *\n * @returns The new date with the hours added\n *\n * @example\n * // Add 2 hours to 10 July 2014 23:00:00:\n * const result = addHours(new Date(2014, 6, 10, 23, 0), 2)\n * //=> Fri Jul 11 2014 01:00:00\n */\nexport function addHours(date, amount, options) {\n  return addMilliseconds(date, amount * millisecondsInHour, options);\n}\n\n// Fallback for modularized imports:\nexport default addHours;\n","import { addHours } from \"./addHours.js\";\n\n/**\n * The {@link subHours} function options.\n */\n\n/**\n * @name subHours\n * @category Hour Helpers\n * @summary Subtract the specified number of hours from the given date.\n *\n * @description\n * Subtract the specified number of hours from the given date.\n *\n * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).\n * @typeParam ResultDate - The result `Date` type, it is the type returned from the context function if it is passed, or inferred from the arguments.\n *\n * @param date - The date to be changed\n * @param amount - The amount of hours to be subtracted.\n * @param options - The options\n *\n * @returns The new date with the hours subtracted\n *\n * @example\n * // Subtract 2 hours from 11 July 2014 01:00:00:\n * const result = subHours(new Date(2014, 6, 11, 1, 0), 2)\n * //=> Thu Jul 10 2014 23:00:00\n */\nexport function subHours(date, amount, options) {\n  return addHours(date, -amount, options);\n}\n\n// Fallback for modularized imports:\nexport default subHours;\n","/**\n * Medical Calendar Integration\n * Generates RFC 5545 compliant ICS files for patient calendars.\n */\n\nexport function generateICS(appointment: {\n    id: string;\n    dateTime: Date;\n    duration: number;\n    summary: string;\n    description?: string;\n}) {\n    const start = appointment.dateTime.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\n    const end = new Date(appointment.dateTime.getTime() + appointment.duration * 60000)\n        .toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';\n\n    const icsContent = [\n        'BEGIN:VCALENDAR',\n        'VERSION:2.0',\n        'PRODID:-//Zlati Pediatrics//EN',\n        'BEGIN:VEVENT',\n        `UID:${appointment.id}`,\n        `DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z'}`,\n        `DTSTART:${start}`,\n        `DTEND:${end}`,\n        `SUMMARY:${appointment.summary}`,\n        `DESCRIPTION:${appointment.description || ''}`,\n        'LOCATION:Dr. Zlati Pediatrics London',\n        'END:VEVENT',\n        'END:VCALENDAR'\n    ].join('\\r\\n');\n\n    return icsContent;\n}\n"],"names":[],"mappings":"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","ignoreList":[1,2,3,4]}